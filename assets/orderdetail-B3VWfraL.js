import{r as n,j as e,D as y,P as f,S as b,I as S,H as I,T as l,E as A,F as W,B as Se,O as Oe,G as $,J as Pe,W as Te}from"./index-CO2zk-35.js";import{P as qe,C as X}from"./product-view-Cla3Js7k.js";import{D,a as k,b as w,c as L}from"./DialogTitle-CxC_bjjG.js";import{F as Y,T,L as De}from"./LoadingButton-BpZaltbh.js";import{D as Z}from"./DialogContentText-C7vGkdOZ.js";import{C as ke}from"./customer-view-DzXXAtOS.js";import{e as we,f as Le,b as Fe,T as K,a as d,g as Ae}from"./search-fill-D-5AyYeE.js";import{G as q}from"./Grid-DdL42mtf.js";import{C as We}from"./Container-BNBsXnZN.js";import{C as $e}from"./Card-BsTQANlG.js";import{u as Ie}from"./use-auth-L8330Noa.js";import"./Select-tk9dLo85.js";import"./isMuiElement-BvOguQpZ.js";function ee({onSelect:c}){const[x,u]=n.useState(!1),m=()=>{u(!0)},h=()=>{u(!1)},g=_=>{c(_),h()};return e.jsxs("div",{children:[e.jsx(y,{variant:"outlined",onClick:m,children:"Add Product"}),e.jsxs(D,{open:x,onClose:h,maxWidth:"xl",fullWidth:!0,children:[e.jsx(k,{children:"Products"}),e.jsx(w,{children:e.jsx(Y,{sx:{width:"100%"},children:e.jsx(qe,{onSelect:g,style:{width:"100%"}})})}),e.jsx(L,{children:e.jsx(y,{onClick:h,color:"primary",children:"Close"})})]})]})}ee.propTypes={onSelect:f.func};function te({handleSendOrder:c}){const[x,u]=n.useState(!1),m=()=>{u(!0)},h=()=>{u(!1)};return e.jsxs(b,{direction:"row",alignItems:"center",children:[e.jsxs(b,{direction:"column",alignItems:"center",spacing:1,children:[e.jsx(S,{onClick:m,sx:{color:"blue",backgroundColor:"#ddf","&:hover":{backgroundColor:"#bbf"}},children:e.jsx(I,{icon:"mdi:send"})}),e.jsx(l,{variant:"caption",sx:{color:"blue"},children:"Email"})]}),e.jsxs(D,{open:x,onClose:h,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(k,{id:"alert-dialog-title",children:"Confirm Send"}),e.jsx(w,{children:e.jsx(Z,{id:"alert-dialog-description",children:"Are you sure you want to send this order?"})}),e.jsxs(L,{children:[e.jsx(y,{onClick:h,color:"primary",children:"Cancel"}),e.jsx(y,{onClick:c,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})}te.propTypes={handleSendOrder:f.func};function re({onSelect:c,filterParentContactOption:x}){const[u,m]=n.useState(!1),h=()=>{m(!0)},g=()=>{m(!1)},_=s=>{c(s),g()};return n.useEffect(()=>{console.log("DeliveryPopupModal Props:"),console.log("filterParentContactOption:",x)},[c,x]),e.jsxs("div",{children:[e.jsx(y,{variant:"outlined",onClick:h,children:"Set"}),e.jsxs(D,{open:u,onClose:g,maxWidth:"xl",fullWidth:!0,children:[e.jsx(k,{children:"Shipping Addresses"}),e.jsx(w,{sx:{padding:0},children:e.jsx(Y,{sx:{width:"100%"},children:e.jsx(ke,{onSelect:_,filterTypeOption:"delivery",filterParentContactOption:x,style:{width:"100%"}})})}),e.jsx(L,{children:e.jsx(y,{onClick:g,color:"primary",children:"Close"})})]})]})}re.propTypes={onSelect:f.func,filterParentContactOption:f.number};function oe({handleCancelOrder:c}){const[x,u]=n.useState(!1),m=()=>{u(!0)},h=()=>{u(!1)};return e.jsxs(b,{direction:"row",alignItems:"center",children:[e.jsxs(b,{direction:"column",alignItems:"center",spacing:1,children:[e.jsx(S,{onClick:m,sx:{color:"red",backgroundColor:"#fdd","&:hover":{backgroundColor:"#fbb"}},children:e.jsx(I,{icon:"eva:close-outline"})}),e.jsx(l,{variant:"caption",sx:{color:"red"},children:"Cancel"})]}),e.jsxs(D,{open:x,onClose:h,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(k,{id:"alert-dialog-title",children:"Confirm Cancellation"}),e.jsx(w,{children:e.jsx(Z,{id:"alert-dialog-description",children:"Are you sure you want to cancel this order?"})}),e.jsxs(L,{children:[e.jsx(y,{onClick:h,color:"primary",children:"Cancel"}),e.jsx(y,{onClick:c,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})}oe.propTypes={handleCancelOrder:f.func};function ne({orderId:c}){const[x,u]=n.useState(!1),[m,h]=n.useState(""),[g,_]=n.useState(""),[s,B]=n.useState({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""}),[j,O]=n.useState([]),[E,ae]=n.useState([]),[R,se]=n.useState({}),[ie,N]=n.useState(0),[le,U]=n.useState(0),[de,ce]=n.useState(0),[z,M]=n.useState(""),[Q,G]=n.useState(""),[V,ue]=n.useState(""),[H,he]=n.useState("");n.useEffect(()=>{fe()},[]);const pe=()=>{F(!0,!1)},xe=()=>{F(!1,!0)},je=t=>{console.log("Fetching order totals");const r=`${$.baseURL}/api-proxy/proxy?method=post&resource=ordertotals`;console.log(r);const o={order_line:j.map(a=>({product_id:a[2].id,product_uom_qty:a[2].product_uom_qty}))};console.log("Request body",o),A.post(r,o,{headers:{Authorization:`Bearer ${W.get("jwt")}`}}).then(a=>{console.log(a.data),se(a.data.result.product_prices),N(a.data.result.subtotal),U(a.data.result.total)}).catch(a=>{console.error("Error fetching order totals:",a)})};n.useEffect(()=>{je();const t=j.reduce((r,i)=>r+i[2].product_uom_qty,0);ce(t)},[j]);const me=t=>{M(t.target.value)},ge=t=>{G(t.target.value)},F=(t,r)=>{u(!0),console.log("Saving Order");let i="post";t===!0&&(i="cancel");const o=`${$.baseURL}/api-proxy/proxy?method=${i}&resource=orders`;console.log(o),console.log(j);const a=j.map(p=>[p[0],p[1],{product_id:p[2].id,product_uom_qty:p[2].product_uom_qty}]),C=E.map(p=>[2,p[1],{}]),v=a.concat(C),J={order:{id:parseInt(c,10),order_line:v,x_studio_notes:z,client_order_ref:Q,...r&&{is_send:!0},...s.id&&{partner_shipping_id:s.id}}};console.log("Request body",J),A.post(o,J,{headers:{Authorization:`Bearer ${W.get("jwt")}`}}).then(p=>{console.log(p.data),u(!1),p.data.result.success===!1?alert(p.data.result.message):window.location.reload()}).catch(p=>{console.error("Error saving order:",p)})},ye=(t,r,i)=>{if(t<0||t>=j.length)return;const o=j.filter((C,v)=>v===t);o[0][0]!==0&&(console.log("Adding line to delete queue",o),ae(E.concat(o)));const a=j.filter((C,v)=>v!==t);O(a)},be=(t,r)=>{const i=j.map((o,a)=>{if(a===t){console.log("handle qty change",o);const C=["consu","service"];return o[2].qty_available<r&&!C.includes(o[2].type)?(alert("Quantity available is insufficient."),o):[o[0],o[1],{...o[2],product_uom_qty:r!==0?Number(r):0}]}return o});O(i)},P=t=>t?`$${t.toFixed(2)}`:"",fe=()=>{console.log("Fetching Order Details");const t=`${$.baseURL}/api-proxy/proxy?method=get&resource=orders&order_id=${c}`;console.log(t),A.get(t,{headers:{Authorization:`Bearer ${W.get("jwt")}`}}).then(r=>{console.log(r.data.data),h(r.data.data.name),ue(r.data.data.ship_tracking_number),he(r.data.data.ship_date),B(r.data.data.partner_shipping_id),M(r.data.data.x_studio_notes),G(r.data.data.client_order_ref?r.data.data.client_order_ref:"");const i=r.data.data.order_line.map(o=>[1,o.id,{line_id:o.id,id:o.product_id.id,name:o.name,product_uom_qty:o.product_uom_qty,attributes:o.product_id.attributes.map(a=>`${a.attribute}:${a.name}`),qty_available:o.product_id.qty_available,type:o.product_id.type}]);console.log(i),O(i),N(r.data.data.amount_untaxed),U(r.data.data.amount_total),_(r.data.data.state)}).catch(r=>{console.error("Error fetching order details:",r)})},_e=t=>{console.log("Setting order partner"),console.log(t),B({id:t.id,name:t.name,street:t.street,city:t.city,state:t.state,country:t.country,zip:t.zip,phone:t.phone,mobile:t.mobile,email:t.email})},Ce=t=>{console.log("Adding order line"),console.log(t);const r=["consu","service"];t.qty_available<1&&!r.includes(t.type)?alert("Cannot add product lines with 0 qty available"):O([...j,[0,0,{id:t.id,name:`[${t.default_code}] ${t.name}`,product_uom_qty:1,attributes:t.attributes,qty_available:t.qty_available}]])},ve=e.jsxs(e.Fragment,{children:[s.name&&e.jsx(b,{spacing:3,direction:"row",alignItems:"center",children:e.jsx(T,{fullWidth:!0,name:"partner_shipping_id",label:"Delivery Address",value:s.name,InputProps:{readOnly:!0,endAdornment:e.jsx(Se,{display:"flex",alignItems:"center",children:e.jsx(S,{children:e.jsx(re,{onSelect:_e})})})}})}),V&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(l,{variant:"body1",children:[e.jsx("strong",{children:"Tracking #: "}),V]})]}),H&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(l,{variant:"body1",children:[e.jsx("strong",{children:"Ship Date: "}),H]})]}),s.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(l,{variant:"body1",fontWeight:"bold",children:"Address:"}),e.jsx(l,{variant:"body1",children:s.street}),e.jsxs(l,{variant:"body1",children:[s.city," ",s.state]}),e.jsxs(l,{variant:"body1",children:[s.country," ",s.zip]}),e.jsxs(l,{variant:"body1",children:[e.jsx("b",{children:"Phone:"})," ",s.phone]}),e.jsxs(l,{variant:"body1",children:[e.jsx("b",{children:"Mobile:"})," ",s.mobile]}),e.jsxs(l,{variant:"body1",children:[e.jsx("b",{children:"Email:"})," ",s.email]})]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(S,{children:e.jsx(ee,{onSelect:Ce})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(we,{component:Oe,children:e.jsxs(Le,{children:[e.jsx(Fe,{children:e.jsxs(K,{children:[e.jsx(d,{children:"Product"}),e.jsx(d,{children:"Attributes"}),e.jsx(d,{children:"Unit Price"}),e.jsx(d,{children:"Qty Available"}),e.jsx(d,{children:"Qty"}),e.jsx(d,{children:"Subtotal"}),e.jsx(d,{})]})}),e.jsx(Ae,{children:j.map((t,r)=>e.jsxs(K,{children:[e.jsx(d,{children:t[2].name}),e.jsx(d,{children:t[2].attributes.map((i,o)=>e.jsx(X,{label:i,variant:"outlined"},o))}),e.jsx(d,{children:P(R[t[2].id])}),e.jsx(d,{children:t[2].qty_available}),e.jsx(d,{children:e.jsx(T,{type:"number",style:{minWidth:"100px"},value:t[2].product_uom_qty!==0?t[2].product_uom_qty:"",onChange:i=>be(r,i.target.value)})}),e.jsx(d,{children:P(R[t[2].id]*t[2].product_uom_qty)}),e.jsx(d,{align:"right",children:e.jsx(S,{onClick:()=>ye(r),children:e.jsx(I,{icon:"eva:trash-2-outline"})})})]},r))})]})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(l,{variant:"body1",fontWeight:"bold",children:["Total Product Qty: ",de]}),e.jsxs(l,{variant:"body1",fontWeight:"bold",children:["Subtotal: ",P(ie)]}),e.jsxs(l,{variant:"body1",fontWeight:"bold",children:["Total: ",P(le)]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(q,{container:!0,spacing:2,children:e.jsx(q,{item:!0,xs:12,md:6,lg:6,children:e.jsx(T,{label:"Notes",value:z,multiline:!0,fullWidth:!0,rows:4,onChange:me})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(q,{container:!0,spacing:2,children:e.jsx(q,{item:!0,xs:12,md:6,lg:6,children:e.jsx(T,{label:"PO Number",value:Q,fullWidth:!0,onChange:ge})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(De,{fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"inherit",onClick:F,loading:x,children:"Save"})]});return e.jsxs(We,{children:[e.jsxs(b,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsxs(l,{variant:"h4",children:["Order: ",m,e.jsx(X,{label:g,color:g==="cancel"?"danger":"primary",variant:"outlined",style:{marginLeft:"10px"}})]}),(g==="draft"||g==="sent")&&e.jsxs(b,{direction:"row",spacing:2,children:[e.jsx(oe,{handleCancelOrder:pe}),e.jsx(te,{handleSendOrder:xe})]})]}),ve,e.jsx($e,{})]})}ne.propTypes={orderId:f.any};function Ke(){Ie();const{orderId:c}=Pe();return e.jsxs(e.Fragment,{children:[e.jsx(Te,{children:e.jsx("title",{children:" Order Detail | BEX Dropship "})}),e.jsx(ne,{orderId:c})]})}export{Ke as default};
