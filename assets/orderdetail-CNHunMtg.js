import{r as a,j as e,D as y,P as C,S as b,I as f,H as B,T as l,E as I,F as W,B as Se,R as Oe,O as Te,G as $,J as Pe,W as qe}from"./index-CLMA9LPH.js";import{P as De,C as J}from"./product-view-DfjojdGl.js";import{D,a as k,b as w,c as L}from"./DialogTitle-DvbYMXdR.js";import{F as K,T as P,L as ke}from"./LoadingButton-BpnpkvCC.js";import{D as Y}from"./DialogContentText-D2r9b05l.js";import{C as we}from"./customer-view-CiNg1E0u.js";import{e as Le,f as Ae,b as Fe,T as X,a as d,g as Ie}from"./search-fill-CVoZuljf.js";import{G as q}from"./Grid-BC_nZdEV.js";import{C as We}from"./Container-f_XcRTmu.js";import{C as $e}from"./Card-BO5XMmKC.js";import{u as Be}from"./use-auth-B5rKOVnK.js";import"./Select-C4XP0Ldw.js";import"./isMuiElement-CTlcFvTB.js";const Ee={width:24,height:24,body:'<g id="evaCopyOutline0"><g id="evaCopyOutline1"><g id="evaCopyOutline2" fill="currentColor"><path d="M18 21h-6a3 3 0 0 1-3-3v-6a3 3 0 0 1 3-3h6a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3Zm-6-10a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1Z"/><path d="M9.73 15H5.67A2.68 2.68 0 0 1 3 12.33V5.67A2.68 2.68 0 0 1 5.67 3h6.66A2.68 2.68 0 0 1 15 5.67V9.4h-2V5.67a.67.67 0 0 0-.67-.67H5.67a.67.67 0 0 0-.67.67v6.66a.67.67 0 0 0 .67.67h4.06Z"/></g></g></g>'};function ee({onSelect:c}){const[x,u]=a.useState(!1),j=()=>{u(!0)},h=()=>{u(!1)},m=v=>{c(v),h()};return e.jsxs("div",{children:[e.jsx(y,{variant:"outlined",onClick:j,children:"Add Product"}),e.jsxs(D,{open:x,onClose:h,maxWidth:"xl",fullWidth:!0,children:[e.jsx(k,{children:"Products"}),e.jsx(w,{children:e.jsx(K,{sx:{width:"100%"},children:e.jsx(De,{onSelect:m,style:{width:"100%"}})})}),e.jsx(L,{children:e.jsx(y,{onClick:h,color:"primary",children:"Close"})})]})]})}ee.propTypes={onSelect:C.func};function te({handleSendOrder:c}){const[x,u]=a.useState(!1),j=()=>{u(!0)},h=()=>{u(!1)};return e.jsxs(b,{direction:"row",alignItems:"center",children:[e.jsxs(b,{direction:"column",alignItems:"center",spacing:1,children:[e.jsx(f,{onClick:j,sx:{color:"blue",backgroundColor:"#ddf","&:hover":{backgroundColor:"#bbf"}},children:e.jsx(B,{icon:"mdi:send"})}),e.jsx(l,{variant:"caption",sx:{color:"blue"},children:"Email"})]}),e.jsxs(D,{open:x,onClose:h,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(k,{id:"alert-dialog-title",children:"Confirm Send"}),e.jsx(w,{children:e.jsx(Y,{id:"alert-dialog-description",children:"Are you sure you want to send this order?"})}),e.jsxs(L,{children:[e.jsx(y,{onClick:h,color:"primary",children:"Cancel"}),e.jsx(y,{onClick:c,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})}te.propTypes={handleSendOrder:C.func};function re({onSelect:c,filterParentContactOption:x}){const[u,j]=a.useState(!1),h=()=>{j(!0)},m=()=>{j(!1)},v=s=>{c(s),m()};return a.useEffect(()=>{console.log("DeliveryPopupModal Props:"),console.log("filterParentContactOption:",x)},[c,x]),e.jsxs("div",{children:[e.jsx(y,{variant:"outlined",onClick:h,children:"Set"}),e.jsxs(D,{open:u,onClose:m,maxWidth:"xl",fullWidth:!0,children:[e.jsx(k,{children:"Shipping Addresses"}),e.jsx(w,{sx:{padding:0},children:e.jsx(K,{sx:{width:"100%"},children:e.jsx(we,{onSelect:v,filterTypeOption:"delivery",filterParentContactOption:x,style:{width:"100%"}})})}),e.jsx(L,{children:e.jsx(y,{onClick:m,color:"primary",children:"Close"})})]})]})}re.propTypes={onSelect:C.func,filterParentContactOption:C.number};function oe({handleCancelOrder:c}){const[x,u]=a.useState(!1),j=()=>{u(!0)},h=()=>{u(!1)};return e.jsxs(b,{direction:"row",alignItems:"center",children:[e.jsxs(b,{direction:"column",alignItems:"center",spacing:1,children:[e.jsx(f,{onClick:j,sx:{color:"red",backgroundColor:"#fdd","&:hover":{backgroundColor:"#fbb"}},children:e.jsx(B,{icon:"eva:close-outline"})}),e.jsx(l,{variant:"caption",sx:{color:"red"},children:"Cancel"})]}),e.jsxs(D,{open:x,onClose:h,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(k,{id:"alert-dialog-title",children:"Confirm Cancellation"}),e.jsx(w,{children:e.jsx(Y,{id:"alert-dialog-description",children:"Are you sure you want to cancel this order?"})}),e.jsxs(L,{children:[e.jsx(y,{onClick:h,color:"primary",children:"Cancel"}),e.jsx(y,{onClick:c,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})}oe.propTypes={handleCancelOrder:C.func};function ae({orderId:c}){const[x,u]=a.useState(!1),[j,h]=a.useState(""),[m,v]=a.useState(""),[s,E]=a.useState({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""}),[g,O]=a.useState([]),[R,ne]=a.useState([]),[M,se]=a.useState({}),[ie,N]=a.useState(0),[le,U]=a.useState(0),[de,ce]=a.useState(0),[z,Q]=a.useState(""),[V,G]=a.useState(""),[A,ue]=a.useState(""),[H,he]=a.useState("");a.useEffect(()=>{fe()},[]);const pe=()=>{F(!0,!1)},xe=()=>{F(!1,!0)},ge=t=>{console.log("Fetching order totals");const r=`${$.baseURL}/api-proxy/proxy?method=post&resource=ordertotals`;console.log(r);const o={order_line:g.map(n=>({product_id:n[2].id,product_uom_qty:n[2].product_uom_qty}))};console.log("Request body",o),I.post(r,o,{headers:{Authorization:`Bearer ${W.get("jwt")}`}}).then(n=>{console.log(n.data),se(n.data.result.product_prices),N(n.data.result.subtotal),U(n.data.result.total)}).catch(n=>{console.error("Error fetching order totals:",n)})};a.useEffect(()=>{ge();const t=g.reduce((r,i)=>r+i[2].product_uom_qty,0);ce(t)},[g]);const je=t=>{Q(t.target.value)},me=t=>{G(t.target.value)},F=(t,r)=>{u(!0),console.log("Saving Order");let i="post";t===!0&&(i="cancel");const o=`${$.baseURL}/api-proxy/proxy?method=${i}&resource=orders`;console.log(o),console.log(g);const n=g.map(p=>[p[0],p[1],{product_id:p[2].id,product_uom_qty:p[2].product_uom_qty}]),_=R.map(p=>[2,p[1],{}]),S=n.concat(_),Z={order:{id:parseInt(c,10),order_line:S,x_studio_notes:z,client_order_ref:V,...r&&{is_send:!0},...s.id&&{partner_shipping_id:s.id}}};console.log("Request body",Z),I.post(o,Z,{headers:{Authorization:`Bearer ${W.get("jwt")}`}}).then(p=>{console.log(p.data),u(!1),p.data.result.success===!1?alert(p.data.result.message):window.location.reload()}).catch(p=>{console.error("Error saving order:",p)})},ye=(t,r,i)=>{if(t<0||t>=g.length)return;const o=g.filter((_,S)=>S===t);o[0][0]!==0&&(console.log("Adding line to delete queue",o),ne(R.concat(o)));const n=g.filter((_,S)=>S!==t);O(n)},be=(t,r)=>{const i=g.map((o,n)=>{if(n===t){console.log("handle qty change",o);const _=["consu","service"];return o[2].qty_available<r&&!_.includes(o[2].type)?(alert("Quantity available is insufficient."),o):[o[0],o[1],{...o[2],product_uom_qty:r!==0?Number(r):0}]}return o});O(i)},T=t=>t?`$${t.toFixed(2)}`:"",fe=()=>{console.log("Fetching Order Details");const t=`${$.baseURL}/api-proxy/proxy?method=get&resource=orders&order_id=${c}`;console.log(t),I.get(t,{headers:{Authorization:`Bearer ${W.get("jwt")}`}}).then(r=>{console.log(r.data.data),h(r.data.data.name),ue(r.data.data.ship_tracking_number),he(r.data.data.ship_date),E(r.data.data.partner_shipping_id),Q(r.data.data.x_studio_notes),G(r.data.data.client_order_ref?r.data.data.client_order_ref:"");const i=r.data.data.order_line.map(o=>[1,o.id,{line_id:o.id,id:o.product_id.id,name:o.name,product_uom_qty:o.product_uom_qty,attributes:o.product_id.attributes.map(n=>`${n.attribute}:${n.name}`),qty_available:o.product_id.qty_available,type:o.product_id.type}]);console.log(i),O(i),N(r.data.data.amount_untaxed),U(r.data.data.amount_total),v(r.data.data.state)}).catch(r=>{console.error("Error fetching order details:",r)})},Ce=t=>{console.log("Setting order partner"),console.log(t),E({id:t.id,name:t.name,street:t.street,city:t.city,state:t.state,country:t.country,zip:t.zip,phone:t.phone,mobile:t.mobile,email:t.email})},ve=t=>{console.log("Adding order line"),console.log(t);const r=["consu","service"];t.qty_available<1&&!r.includes(t.type)?alert("Cannot add product lines with 0 qty available"):O([...g,[0,0,{id:t.id,name:`[${t.default_code}] ${t.name}`,product_uom_qty:1,attributes:t.attributes,qty_available:t.qty_available}]])},_e=e.jsxs(e.Fragment,{children:[s.name&&e.jsx(b,{spacing:3,direction:"row",alignItems:"center",children:e.jsx(P,{fullWidth:!0,name:"partner_shipping_id",label:"Delivery Address",value:s.name,InputProps:{readOnly:!0,endAdornment:e.jsx(Se,{display:"flex",alignItems:"center",children:e.jsx(f,{children:e.jsx(re,{onSelect:Ce})})})}})}),A&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(l,{variant:"body1",children:[e.jsx("strong",{children:"Tracking #: "}),A,e.jsx(f,{onClick:()=>{navigator.clipboard.writeText(A),alert("Tracking number copied to clipboard!")},children:e.jsx(Oe,{icon:Ee,sx:{color:"text.disabled",width:20,height:20}})})]})]}),H&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(l,{variant:"body1",children:[e.jsx("strong",{children:"Ship Date: "}),H]})]}),s.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(l,{variant:"body1",fontWeight:"bold",children:"Address:"}),e.jsx(l,{variant:"body1",children:s.street}),e.jsxs(l,{variant:"body1",children:[s.city," ",s.state]}),e.jsxs(l,{variant:"body1",children:[s.country," ",s.zip]}),e.jsxs(l,{variant:"body1",children:[e.jsx("b",{children:"Phone:"})," ",s.phone]}),e.jsxs(l,{variant:"body1",children:[e.jsx("b",{children:"Mobile:"})," ",s.mobile]}),e.jsxs(l,{variant:"body1",children:[e.jsx("b",{children:"Email:"})," ",s.email]})]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(f,{children:e.jsx(ee,{onSelect:ve})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(Le,{component:Te,children:e.jsxs(Ae,{children:[e.jsx(Fe,{children:e.jsxs(X,{children:[e.jsx(d,{children:"Product"}),e.jsx(d,{children:"Attributes"}),e.jsx(d,{children:"Unit Price"}),e.jsx(d,{children:"Qty Available"}),e.jsx(d,{children:"Qty"}),e.jsx(d,{children:"Subtotal"}),e.jsx(d,{})]})}),e.jsx(Ie,{children:g.map((t,r)=>e.jsxs(X,{children:[e.jsx(d,{children:t[2].name}),e.jsx(d,{children:t[2].attributes.map((i,o)=>e.jsx(J,{label:i,variant:"outlined"},o))}),e.jsx(d,{children:T(M[t[2].id])}),e.jsx(d,{children:t[2].qty_available}),e.jsx(d,{children:e.jsx(P,{type:"number",style:{minWidth:"100px"},value:t[2].product_uom_qty!==0?t[2].product_uom_qty:"",onChange:i=>be(r,i.target.value)})}),e.jsx(d,{children:T(M[t[2].id]*t[2].product_uom_qty)}),e.jsx(d,{align:"right",children:e.jsx(f,{onClick:()=>ye(r),children:e.jsx(B,{icon:"eva:trash-2-outline"})})})]},r))})]})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(l,{variant:"body1",fontWeight:"bold",children:["Total Product Qty: ",de]}),e.jsxs(l,{variant:"body1",fontWeight:"bold",children:["Subtotal: ",T(ie)]}),e.jsxs(l,{variant:"body1",fontWeight:"bold",children:["Total: ",T(le)]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(q,{container:!0,spacing:2,children:e.jsx(q,{item:!0,xs:12,md:6,lg:6,children:e.jsx(P,{label:"Notes",value:z,multiline:!0,fullWidth:!0,rows:4,onChange:je})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(q,{container:!0,spacing:2,children:e.jsx(q,{item:!0,xs:12,md:6,lg:6,children:e.jsx(P,{label:"PO Number",value:V,fullWidth:!0,onChange:me})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(ke,{fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"inherit",onClick:F,loading:x,children:"Save"})]});return e.jsxs(We,{children:[e.jsxs(b,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsxs(l,{variant:"h4",children:["Order: ",j,e.jsx(J,{label:m,color:m==="cancel"?"danger":"primary",variant:"outlined",style:{marginLeft:"10px"}})]}),(m==="draft"||m==="sent")&&e.jsxs(b,{direction:"row",spacing:2,children:[e.jsx(oe,{handleCancelOrder:pe}),e.jsx(te,{handleSendOrder:xe})]})]}),_e,e.jsx($e,{})]})}ae.propTypes={orderId:C.any};function Ye(){Be();const{orderId:c}=Pe();return e.jsxs(e.Fragment,{children:[e.jsx(qe,{children:e.jsx("title",{children:" Order Detail | BEX Dropship "})}),e.jsx(ae,{orderId:c})]})}export{Ye as default};
